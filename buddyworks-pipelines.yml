- pipeline: "Beta Deploy"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "develop"
  ref_type: "BRANCH"
  target_site_url: "https://beta-catalog-mobile.web.app"
  execution_message_template: "$BUDDY_EXECUTION_REVISION_MESSAGE"
  auto_clear_cache: true
  trigger_condition: "ALWAYS"
  actions:
  - action: "Enviroments Variable"
    type: "BUILD"
    working_directory: "/buddy/catalog-mobile"
    docker_image_name: "library/ubuntu"
    docker_image_tag: "18.04"
    execute_commands:
    - "export AMBIENT='beta'"
    - "export FIREBASE_PROJECT='flourigh'"
    mount_filesystem_path: "/buddy/catalog-mobile"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Send notification"
    type: "PUSHOVER"
    title: "$BUDDY_PIPELINE_REF_NAME $BUDDY_EXECUTION_START_DATE #$BUDDY_EXECUTION_ID"
    content: "$BUDDY_EXECUTION_REVISION_COMMITTER_EMAIL\r\n$BUDDY_EXECUTION_REVISION_COMMITTER_NAME\r\n$BUDDY_REPO_SLUG\r\n\r\n$BUDDY_EXECUTION_REVISION_MESSAGE"
    link: "$BUDDY_EXECUTION_URL"
    link_title: "$BUDDY_PIPELINE_TARGET_SITE_URL"
    device: "gr3m2u755gku7ou6chr3obnmh77t9k"
    priority: "LOW"
    trigger_condition: "ALWAYS"
    integration_id: 66792
  - action: "Create Files"
    type: "BUILD"
    working_directory: "/buddy/catalog-mobile"
    docker_image_name: "library/ubuntu"
    docker_image_tag: "18.04"
    execute_commands:
    - "mkdir dist"
    - "> firebase.json"
    - "> .firebaserc"
    - "echo \"${BUDDY_EXECUTION_START_DATE}\" >> dist/index.html"
    - "echo '{' >> firebase.json"
    - "echo '  \"hosting\": {' >> firebase.json"
    - "echo '    \"public\": \"dist\",' >> firebase.json"
    - "echo '    \"site\": \"'${AMBIENT}'-'${BUDDY_PROJECT_NAME_ID}'\",' >> firebase.json"
    - "echo '    \"ignore\": [' >> firebase.json"
    - "echo '      \"firebase.json\",' >> firebase.json"
    - "echo '      \"**/.*\",' >> firebase.json"
    - "echo '      \"**/node_modules/**\"' >> firebase.json"
    - "echo '    ],' >> firebase.json"
    - "echo '    \"rewrites\": [' >> firebase.json"
    - "echo '      {' >> firebase.json"
    - "echo '        \"source\": \"**\",' >> firebase.json"
    - "echo '        \"destination\": \"/index.html\"' >> firebase.json"
    - "echo '      }' >> firebase.json"
    - "echo '    ]' >> firebase.json"
    - "echo '  }' >> firebase.json"
    - "echo '}' >> firebase.json"
    - "echo '{' >> .firebaserc"
    - "echo '  \"projects\": {' >> .firebaserc"
    - "echo '    \"default\": \"'${AMBIENT}'-'${FIREBASE_PROJECT}'\"' >> .firebaserc"
    - "echo '  }' >> .firebaserc"
    - "echo '}' >> .firebaserc"
    - ""
    mount_filesystem_path: "/buddy/catalog-mobile"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Npm run build"
    type: "BUILD"
    working_directory: "/buddy/catalog-mobile"
    docker_image_name: "library/node"
    docker_image_tag: "10"
    execute_commands:
    - "# yarn install"
    - "npm install"
    - "# npm run build"
    setup_commands:
    - "npm install -g gulp grunt-cli"
    mount_filesystem_path: "/buddy/catalog-mobile"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Firebase deploy"
    type: "FIREBASE"
    working_directory: "/buddy/catalog-mobile"
    version: "12"
    application_id: "$AMBIENT-$FIREBASE_PROJECT"
    execute_commands:
    - "firebase deploy --non-interactive --only hosting:${AMBIENT}-${BUDDY_PROJECT_NAME_ID}"
    mount_filesystem_path: "/buddy/catalog-mobile"
    build_tool_version: "7.6.2"
    trigger_condition: "ALWAYS"
    integration_id: 52811
  - action: "Clear"
    type: "BUILD"
    working_directory: "/buddy/catalog-mobile"
    docker_image_name: "library/ubuntu"
    docker_image_tag: "18.04"
    execute_commands:
    - "rm -rf *"
    mount_filesystem_path: "/buddy/catalog-mobile"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Send notification"
    type: "PUSHOVER"
    trigger_time: "ON_FAILURE"
    title: "$BUDDY_PROJECT_NAME $BUDDY_EXECUTION_BRANCH"
    content: "Erro ao executar: $BUDDY_PIPELINE_NAME #$BUDDY_EXECUTION_ID\r\n\r\n$BUDDY_EXECUTION_URL"
    link: "$BUDDY_EXECUTION_URL"
    link_title: "$BUDDY_PIPELINE_NAME: #$BUDDY_EXECUTION_ID"
    device: "gr3m2u755gku7ou6chr3obnmh77t9k"
    priority: "HIGH"
    trigger_condition: "ALWAYS"
    integration_id: 66792
